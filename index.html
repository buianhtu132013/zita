<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Z-ita</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:sans-serif;margin:0;background:#f0f2f5}
header{background:#1877f2;color:#fff;padding:10px;font-weight:bold}
#login,#logout{margin:10px;padding:8px}
#postBox{display:none;padding:10px}
textarea{width:100%;height:60px}
button{padding:8px;margin-top:5px}
.post{background:#fff;margin:10px;padding:10px;border-radius:6px}
</style>
</head>
<body>

<header>Z-ita</header>

<button id="login">ÄÄƒng nháº­p Google</button>
<button id="logout" style="display:none">ÄÄƒng xuáº¥t</button>

<div id="user"></div>

<div id="postBox">
  <textarea id="content" placeholder="Viáº¿t gÃ¬ Ä‘Ã³..."></textarea>
  <button id="postBtn">ÄÄƒng bÃ i</button>
</div>

<div id="posts"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyA11JBfnZ4ludqs0kdrmPHhmbFxuS2kcBc",
  authDomain: "z-ita-c9424.firebaseapp.com",
  projectId: "z-ita-c9424",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

const loginBtn = document.getElementById("login");
const logoutBtn = document.getElementById("logout");
const postBox = document.getElementById("postBox");
const postsDiv = document.getElementById("posts");

let currentUser = null;

// LOGIN
loginBtn.onclick = () => {
  signInWithPopup(auth, provider);
};

// LOGOUT
logoutBtn.onclick = () => signOut(auth);

// AUTH STATE
onAuthStateChanged(auth, user => {
  if(user){
    currentUser = user;
    loginBtn.style.display="none";
    logoutBtn.style.display="block";
    postBox.style.display="block";
    document.getElementById("user").innerText = "ğŸ‘¤ " + user.displayName;
    loadPosts();
  }else{
    currentUser = null;
    loginBtn.style.display="block";
    logoutBtn.style.display="none";
    postBox.style.display="none";
    postsDiv.innerHTML="";
  }
});

// POST
document.getElementById("postBtn").onclick = () => {
  const text = document.getElementById("content").value.trim();
  if(!text) return;

  const data = JSON.parse(localStorage.getItem("posts")||"[]");
  data.unshift({
    name: currentUser.displayName,
    text: text,
    uid: currentUser.uid
  });
  localStorage.setItem("posts", JSON.stringify(data));
  document.getElementById("content").value="";
  loadPosts();
};

function loadPosts(){
  const data = JSON.parse(localStorage.getItem("posts")||"[]");
  postsDiv.innerHTML="";
  data.forEach(p=>{
    const div=document.createElement("div");
    div.className="post";
    div.innerHTML=`<b>${p.name}</b><br>${p.text}`;
    postsDiv.appendChild(div);
  });
}
</script>

</body>
</html>
